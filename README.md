# Stack Usage #

One of the more tricky problems when coding for an embedded system is ensuring that each task has enough stack space for its needs.

Most microprocessor control units (MCUs) have limited amounts of RAM; on a general-purpose machine, for example a Linux desktop, it would in theory be possible for a potential stack overflow to be recognised and for additional stack space to be allocated, and even if that's not possible, a large stack can be pre-allocated using virtual memory without any immediate cost.

This can't be done if the MCU only has real memory. Stack overflow may be caught or not. If you're lucky there'll be enough information left behind for you to use the debugger to find the reason for the resulting crash straight away, if not it could take a while. Under [FreeRTOS]((https://www.freertos.org) you're very likely to get a hard fault to add to the joy (stacks and task control blocks live close together, so running off the end of your stack is likely to trample on the stored state of another task, resulting in it trying to access invalid memory).

The Python program `stack_usage.py` is intended to help with this (it's not a panacea, though! if you have [AdaCore](https://www.adacore.com) support, you'll be better off using [GNATstack](https://www.adacore.com/gnatpro/toolsuite/gnatstack)).

The initial motivation for this work was a hard fault encountered while writing a test program to check that Ada [timing events](http://www.ada-auth.org/standards/rm12_w_tc1/html/RM-D-15.html) work properly (well, usably) with the [FreeRTOS]((https://www.freertos.org)-based [Cortex GNAT RTS](https://github.com/simonjwright/cortex-gnat-rts).

## Requirements ##

`stack_usage` has been developed on macOS Mojave using Python 2.7 and 3.7 and [PLY](https://www.dabeaz.com/ply/ply.html) (**P**ython **L**ex and **Y**acc). To install PLY,

``` sh
pip install --user ply
```

It relies on the information generated by the GCC compiler (FSF GCC 10 or later, GNAT GPL 2015 or later) using the switch `-fcallgraph-info=su,da`.

## Use ##

The first step is to make sure that the runtime libraries used by your program have been compiled with the `-fcallgraph-info=su,da` switch.

<!--
## Case study ##

_coming soon_

## Restrictions ##

_coming soon_
-->
